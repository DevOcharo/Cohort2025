<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Membership Payment</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body>
    <main class="container">
        <h1>Membership Payment</h1>
        <form x-data="paymentForm()" @submit.prevent="processPayment" class="card">
            <div class="form-group">
                <label>Membership Plan</label>
                <div class="form-control">
                    <select x-model="selectedPlan" class="form-select">
                        <option value="monthly">Monthly ($9.99)</option>
                        <option value="yearly">Yearly ($99.99)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>Payment Method</label>
                <div class="form-control">
                    <div class="form-radio">
                        <input type="radio" id="card" name="method" value="card" x-model="paymentMethod">
                        <label for="card">Credit Card</label>
                    </div>
                    <div class="form-radio">
                        <input type="radio" id="mobile" name="method" value="mobile" x-model="paymentMethod">
                        <label for="mobile">Mobile Money</label>
                    </div>
                </div>
            </div>

            <div class="form-group" x-show="paymentMethod === 'card'">
                <label>Card Details</label>
                <div class="form-control">
                    <input type="text" placeholder="Card Number" x-model="cardNumber" class="form-input">
                    <input type="text" placeholder="MM/YY" x-model="expiry" class="form-input">
                    <input type="text" placeholder="CVV" x-model="cvv" class="form-input">
                </div>
            </div>

            <div class="form-group" x-show="paymentMethod === 'mobile'">
                <label>Mobile Number</label>
                <div class="form-control">
                    <input type="text" placeholder="+2547XX XXX XXX" x-model="mobileNumber" class="form-input">
                </div>
            </div>

            <div class="form-group">
                <button type="submit" 
                        :class="{'btn-primary': !processing, 'btn-disabled': processing}"
                        :disabled="processing"
                        x-text="processing ? 'Processing...' : 'Complete Payment'">
                </button>
            </div>
        </form>

        <div x-show="showResult" class="card" :class="{'bg-green-100': success, 'bg-red-100': !success}">
            <div class="card-header">
                <h3 x-text="success ? 'Payment Successful' : 'Payment Failed'"></h3>
            </div>
            <div class="card-body">
                <p x-text="message"></p>
            </div>
        </div>
    </main>

    <script>
        function paymentForm() {
            return {
                selectedPlan: 'monthly',
                paymentMethod: 'card',
                cardNumber: '',
                expiry: '',
                cvv: '',
                mobileNumber: '',
                processing: false,
                showResult: false,
                success: false,
                message: '',

                async processPayment() {
                    this.processing = true;
                    this.showResult = false;

                    try {
                        // IntaSend API integration logic here
                        const response = await fetch('/api/payment', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                plan: this.selectedPlan,
                                method: this.paymentMethod,
                                card: {
                                    number: this.cardNumber,
                                    expiry: this.expiry,
                                    cvv: this.cvv
                                },
                                mobile: this.mobileNumber
                            })
                        });

                        const data = await response.json();
                        this.success = data.success;
                        this.message = data.message;
                        this.showResult = true;
                    } catch (error) {
                        this.success = false;
                        this.message = 'Payment processing failed';
                        this.showResult = true;
                    } finally {
                        this.processing = false;
                    }
                }
            }
        }
    </script>
</body>
</html>
